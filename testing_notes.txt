# *** Simple testing of makeimage

# really small (2x2) image:
./makeimage smalltest_config_4.dat -o smalltest_2x2.fits --ncols 2 --nrows 2

# really small (2x2) image with slightly complicated config:
./makeimage smalltest_config_4b.dat -o smalltest_2x2b.fits --ncols 2 --nrows 2

# slightly larger & more complex (4x4) image:
./makeimage smalltest_config_4c.dat -o smalltest.fits --ncols 4 --nrows 4

# medium-sized, complex (64x64) image:
# Exp+Sersic centered at (31.0,31.0) and Exp+Ser+Gauss at (10.5,13.0)
# and Exp+Gauss at (2.5,2.0)
./makeimage biggertest_config_4c.dat -o biggertest.fits --ncols 64 --nrows 64



# *** Simple testing of imfit:

# really small (2x2) image, made with modelimage + expdisk_tiny_testparams.dat:
#    Input: x0,y0 = 2,2; PA = 90.0, ell = 0.5, I_0 = 100, h = 1.0
./imfit testimage_expdisk_tiny.fits --config smalltest_config_4.dat

./imfit testimage_expdisk_tiny.fits --config smalltest_config_4.dat --noise tiny_uniform_image.fits


# small-ish (32x32) image, made with modelimage + expdisk_testparams_32x32.dat:
#    Input: x0,y0 = 15,15; PA = 90.0, ell = 0.5, I_0 = 100, h = 20.0
# The following *worked* with Dec 2009 code:
$ ./imfit --config imfit_trial_config32.dat --noise uniform_image32.fits testimage_expdisk32.fits 
Reduced Chi^2 = 0.000000
AIC = 8.039254, BIC = 27.725887

          x0 = 15.000000 +/- 0.000000
          y0 = 15.000000 +/- 0.000000
          PA = 90.000000 +/- 0.102986
         ell = 0.500000 +/- 0.001695
         I_0 = 100.000001 +/- 0.151606
           h = 20.000000 +/- 0.071919

# And with current (Feb 2010) code:
$ ./imfit --config imfit_trial_config32_new.dat --noise uniform_image32.fits testimage_expdisk32.fits 
Reduced Chi^2 = 0.000000
Recalculated = 0.000000
AIC = 12.082596, BIC = 41.588831

          X0 = 15.000000 +/- 0.021376
          Y0 = 15.000000 +/- 0.009135
          PA = 90.000000 +/- 0.103197
         ell = 0.500000 +/- 0.001711
         I_0 = 100.000001 +/- 0.152262
           h = 20.000000 +/- 0.072772


# Testing with real image, 1 function
# Testing on SDSS image of IC 3487
$ ./imfit testing/ic3478rss_32x32.fits --config=imfit_config_ic3478_32x32.dat --gain=4.725 --readnoise=4.3 --sky=130.1

(the following takes ~ 3s on MacBook Pro 2009)
$ ./imfit testing/ic3478rss_small.fits --config=imfit_config_ic3478.dat --gain=4.725 --readnoise=4.3 --sky=130.1 --nosubsampling
Reduced Chi^2 = 1.168005
AIC = 73006.120922, BIC = 73069.419582

          X0 = 126.860405 +/- 0.011681
          Y0 = 128.192652 +/- 0.013504
          PA = 19.515407 +/- 0.240219
         ell = 0.226771 +/- 0.001689
           n = 2.314081 +/- 0.008181
         I_e = 21.789633 +/- 0.160831
         r_e = 57.165995 +/- 0.258980


#Testing to catch bad-weight-vector generation (due to negative pixels values and
#failure to specify original sky background):
$ ./imfit testing/ic3478rss_128x128.fits --config=imfit_config_ic3478_128x128.dat --gain=4.725 --readnoise=4.3

#Output should end with:
** WARNING: one or more pixel values in weightVector[] are non-finite!
ModelObject::GenerateErrorVector -- Calculation of error vector resulted in bad values!
Exiting ...


# Testing with real image, 2 functions
# Testing imfit on SDSS image of NGC 3073: (takes about 22s on MacBook Pro 2009)
$ ./imfit testing/n3073rss_small.fits --mask=testing/n3073rss_small_mask.fits --config=imfit_config_n3073.dat --gain=4.725 --readnoise=4.3 --sky=127.0 --nosubsampling
Reduced Chi^2 = 1.387224
AIC = 85612.345726, BIC = 85711.673662

          X0 = 129.622168 +/- 0.004804
          Y0 = 146.152010 +/- 0.004864
          PA = 112.377538 +/- 0.240573
         ell = 0.178229 +/- 0.001408
           n = 1.964242 +/- 0.009489
         I_e = 209.585745 +/- 2.044273
         r_e = 14.394535 +/- 0.100719
          PA = 59.292326 +/- 0.684014
         ell = 0.162339 +/- 0.003710
         I_0 = 76.938586 +/- 1.039381
           h = 45.001772 +/- 0.326984

# Same, with subsampling turned on: (takes about 6s on MacBook Pro 2009)
Reduced Chi^2 = 1.589260
AIC = 98077.734591, BIC = 98177.062526

          X0 = 129.663850 +/- 0.004986
          Y0 = 146.113135 +/- 0.005182
          PA = 180.000000 +/- 0.000000
         ell = 0.000000 +/- 0.000000
           n = 2.008758 +/- 0.010411
         I_e = 201.359204 +/- 2.200926
         r_e = 13.297131 +/- 0.107078
          PA = 83.371821 +/- 0.506494
         ell = 0.193377 +/- 0.003939
         I_0 = 75.688315 +/- 1.169093
           h = 46.398183 +/- 0.402259


